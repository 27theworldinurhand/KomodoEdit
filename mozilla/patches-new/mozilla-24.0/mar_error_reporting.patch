# HG changeset patch
# Parent ca5dfcd6d612779d1fc9fdc2912ef93c72b3a41a
mozilla bug 386245 - add some extra error reporting to mar

Index: /as/komodo-devel_clean/mozilla/build/moz2400-ko8.8/mozilla/modules/libmar/src/mar_extract.c
--- a/modules/libmar/src/mar_extract.c	Tue Aug 27 11:44:54 2013 -0700
+++ b/modules/libmar/src/mar_extract.c	Tue Aug 27 13:05:23 2013 -0700
@@ -6,12 +6,13 @@
 
 #include <sys/types.h>
 #include <sys/stat.h>
 #include <fcntl.h>
 #include <string.h>
 #include <stdlib.h>
+#include <errno.h>
 #include "mar_private.h"
 #include "mar.h"
 
 #ifdef XP_WIN
 #include <io.h>
 #include <direct.h>
@@ -52,14 +53,17 @@
     fprintf(stderr, "ERROR: could not create file in mar_test_callback()\n");
     perror(item->name);
     return -1;
   }
 
   fp = fdopen(fd, "wb");
-  if (!fp)
+  if (!fp) {
+    fprintf(stderr, "mar: ERROR(%d) %s: could not fdopen() descriptor for `%s'\n",
+            errno, strerror(errno), item->name);
     return -1;
+  }
 
   while ((len = mar_read(mar, item, offset, buf, sizeof(buf))) > 0) {
     if (fwrite(buf, len, 1, fp) != 1)
       break;
     offset += len;
   }
@@ -70,14 +74,16 @@
 
 int mar_extract(const char *path) {
   MarFile *mar;
   int rv;
 
   mar = mar_open(path);
-  if (!mar)
-    return -1;
+  if (!mar) {
+     fprintf(stderr, "mar: ERROR: error opening `%s'\n", path);
+     return -1;
+  }
 
   rv = mar_enum_items(mar, mar_test_callback, NULL);
 
   mar_close(mar);
   return rv;
 }
